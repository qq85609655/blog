---
title: 项目构建与部署
date: 2017-06-14 14:05:00
tags: 
    - maven
    - sbt
toc: true
---

[TOC]

## 项目构建

### maven

#### Maven Lifecycle
1. Maven is implemented based around the concept of a build lifecycle. 
2. The stages of a lifecycle are called phases. In each phase, one or more goals can be executed
3. Maven has three built-in build lifecycles:
    - default: The default lifecycle handles project build and deployment
        + validate: This phase validates that all project information is available and correct
        + process-resources: This phase copies project resources to the destination to package
        + compile: This phase compiles the source code
        + test: This phase runs unit tests within a suitable framework
        + package: This phase packages the compiled code in its distribution format
        + integration-test: This phase processes the package in the integration test environment
        + verify: This phase runs checks to verify that the package is valid
        + install: This phase installs the package in the local repository
        + deploy: This phase installs the final package in the configured repository
    - clean: The clean lifecycle cleans up the fles and folders produced by Maven
        + The clean phase removes all the fles and folders created by Maven as part of its build
    - site: The site lifecycle handles the creation of project documentation
        + The site phase generates the project's documentation, which can be published, as well as a template that can be customized further 
4. Each phase is made up of plugin goals. A plugin goal is a specifc task that builds the project.

|Phase |Plugin |Goal|
|:--|:--|:--|
|clean |Maven Clean plugin|clean|
|site |Maven Site plugin|site|
|process-resources |Maven Resources plugin|resource|
|compile |Maven Compiler plugin|compile|
|test |Maven Surefire plugin|test|
|package |Varies based on the packaging; for instance, the Maven JAR plugin|jar (in the case of a Maven JAR plugin)|
|install |Maven Install plugin |install|
|deploy |Maven Deploy plugin |deploy| 
<br>

#### pom.xml project object model
``` xml pom.xml

```

#### settings.xml
``` xml settings.xml

```

#### maven command-line
1. -e –errors
2. -q –quiet    ：When the quiet option is enabled, only errors are displayed. The other outputs are not printed. This permits speeding up builds where verbose outputs are usually displayed
3. -v –version  
4. -o –offline  ：Maven does not attempt to download any dependency or plugin from the Internet. 
5. -X –debug
``` console
$ mvn -h

usage: mvn [options] [<goal(s)>] [<phase(s)>]

Options:
 -am,--also-make                        If project list is specified, also
                                        build projects required by the
                                        list
 -amd,--also-make-dependents            If project list is specified, also
                                        build projects that depend on
                                        projects on the list
 -B,--batch-mode                        Run in non-interactive (batch)
                                        mode (disables output color)
 -b,--builder <arg>                     The id of the build strategy to
                                        use
 -C,--strict-checksums                  Fail the build if checksums don't
                                        match
 -c,--lax-checksums                     Warn if checksums don't match
 -cpu,--check-plugin-updates            Ineffective, only kept for
                                        backward compatibility
 -D,--define <arg>                      Define a system property
 -e,--errors                            Produce execution error messages
 -emp,--encrypt-master-password <arg>   Encrypt master security password
 -ep,--encrypt-password <arg>           Encrypt server password
 -f,--file <arg>                        Force the use of an alternate POM
                                        file (or directory with pom.xml)
 -fae,--fail-at-end                     Only fail the build afterwards;
                                        allow all non-impacted builds to
                                        continue
 -ff,--fail-fast                        Stop at first failure in
                                        reactorized builds
 -fn,--fail-never                       NEVER fail the build, regardless
                                        of project result
 -gs,--global-settings <arg>            Alternate path for the global
                                        settings file
 -gt,--global-toolchains <arg>          Alternate path for the global
                                        toolchains file
 -h,--help                              Display help information
 -l,--log-file <arg>                    Log file where all build output
                                        will go (disables output color)
 -llr,--legacy-local-repository         Use Maven 2 Legacy Local
                                        Repository behaviour, ie no use of
                                        _remote.repositories. Can also be
                                        activated by using
                                        -Dmaven.legacyLocalRepo=true
 -N,--non-recursive                     Do not recurse into sub-projects
 -npr,--no-plugin-registry              Ineffective, only kept for
                                        backward compatibility
 -npu,--no-plugin-updates               Ineffective, only kept for
                                        backward compatibility
 -nsu,--no-snapshot-updates             Suppress SNAPSHOT updates
 -o,--offline                           Work offline
 -P,--activate-profiles <arg>           Comma-delimited list of profiles
                                        to activate
 -pl,--projects <arg>                   Comma-delimited list of specified
                                        reactor projects to build instead
                                        of all projects. A project can be
                                        specified by [groupId]:artifactId
                                        or by its relative path
 -q,--quiet                             Quiet output - only show errors
 -rf,--resume-from <arg>                Resume reactor from specified
                                        project
 -s,--settings <arg>                    Alternate path for the user
                                        settings file
 -t,--toolchains <arg>                  Alternate path for the user
                                        toolchains file
 -T,--threads <arg>                     Thread count, for instance 2.0C
                                        where C is core multiplied
 -U,--update-snapshots                  Forces a check for missing
                                        releases and updated snapshots on
                                        remote repositories
 -up,--update-plugins                   Ineffective, only kept for
                                        backward compatibility
 -v,--version                           Display version information
 -V,--show-version                      Display version information
                                        WITHOUT stopping build
 -X,--debug                             Produce execution debug output
```





##### 纪要
###### 跳过单元测试
1. -Dmaven.test.skip=true  不编译测试类
2. -DskipTests
3. 修改pom.xml
    ``` xml
    <plugin>    
        <groupId>org.apache.maven.plugin</groupId>    
        <artifactId>maven-compiler-plugin</artifactId>    
        <version>2.1</version>    
        <configuration>    
            <skip>true</skip>    
        </configuration>    
    </plugin>    
    <plugin>    
        <groupId>org.apache.maven.plugins</groupId>    
        <artifactId>maven-surefire-plugin</artifactId>    
        <version>2.5</version>    
        <configuration>    
            <skip>true</skip>    
        </configuration>    
    </plugin>    
    ```
4. pom.xml如下，跳过单元测试，会编译
    ``` xml
    <plugin>    
        <groupId>org.apache.maven.plugins</groupId>    
        <artifactId>maven-surefire-plugin</artifactId>    
        <version>2.5</version>    
        <configuration>    
            <skipTests>true</skipTests>    
        </configuration>    
    </plugin> 
    ```

### sbt
